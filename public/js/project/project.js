"use strict";window.EC5=window.EC5||{},window.EC5.projectApps=window.EC5.projectApps||{},function(e){e.currentClientId="",e.getApps=function(){$.ajax({url:"",type:"GET",dataType:"json",data:{}}).done(function(e){$(".project-apps-list").html(e)}).fail(window.EC5.showError)},e.post=function(a,t,n){$.ajax({url:a,type:"POST",dataType:"json",data:t}).done(function(){n&&n(),e.getApps()}).fail(window.EC5.showError)}}(window.EC5.projectApps),$(document).ready(function(){var e=$(".project-apps");e.on("click",".pagination a",function(e){e.preventDefault(),window.EC5.projectApps.getApps()});var a=$("#ec5-form-project-apps");a.on("submit",function(e){e.preventDefault();var a=$(this).serialize(),t=$(this).attr("action");window.EC5.projectApps.post(t,a,function(){$("#create-app").prop("disabled",!0),$("#modal__create-app").modal("hide"),window.EC5.toast.showSuccess("New App added.")})});var t=$(".project-apps-list");t.on("click","#delete-app",function(e){e.preventDefault(),$("#ec5-form-project-app-revoke").addClass("hidden"),$("#ec5-form-project-app-delete").removeClass("hidden"),window.EC5.projectApps.currentClientId=$(this).data("clientId")}),t.on("click","#revoke-app",function(e){e.preventDefault(),$("#ec5-form-project-app-delete").addClass("hidden"),$("#ec5-form-project-app-revoke").removeClass("hidden"),window.EC5.projectApps.currentClientId=$(this).data("clientId")});var n=$("#ec5-form-project-app-delete");n.on("submit",function(e){e.preventDefault();var a={clientId:window.EC5.projectApps.currentClientId},t=$(this).attr("action");window.EC5.projectApps.post(t,a,function(){$("#create-app").prop("disabled",!1),$("#modal__confirm").modal("hide"),window.EC5.toast.showSuccess("App deleted.")})});var o=$("#ec5-form-project-app-revoke");o.on("submit",function(e){e.preventDefault();var a={clientId:window.EC5.projectApps.currentClientId},t=$(this).attr("action");window.EC5.projectApps.post(t,a,function(){$("#modal__confirm").modal("hide"),window.EC5.toast.showSuccess("Access Token revoked.")})})}),window.EC5=window.EC5||{},window.EC5.projectCreate=window.EC5.projectCreate||{},function(e){e.doesProjectExist=function(e){var a=$(".page-create-project").find("#project-name-form-group-create");$.when($.get(e)).done(function(e){console.log(e.data),$("#project-loader").addClass("hidden"),e.data.attributes.exists?window.EC5.projectCreate.toggleGroupValidation(a,!1,"Project already exists"):window.EC5.projectCreate.toggleGroupValidation(a,!0)}).fail(function(){a.addClass("has-error")}).always(function(){$("#project-loader").addClass("hidden")})},e.toggleGroupValidation=function(e,a,t){a?(e.removeClass("has-error"),e.find(".form-control-feedback").not("#project-loader").addClass("hidden"),e.find(".text-danger").addClass("hidden"),e.find(".text-hint").removeClass("hidden")):(e.addClass("has-error"),e.find(".form-control-feedback").not("#project-loader").removeClass("hidden"),e.find(".text-danger").removeClass("hidden").text(t),e.find(".text-hint").addClass("hidden"))}}(window.EC5.projectCreate),$(document).ready(function(){if(0!==$(".page-create-project").length){var e=$("#project-loader");$(".page-create-project #project-name-create").keyup(function(a){var t,n=$(".page-create-project #project-name-form-group-create"),o=$(this),r=o.val(),i=/^[\w\_\s\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+$/;if(i.test(r)||""===r){if(window.EC5.projectCreate.toggleGroupValidation(n,!0),r.length>=3){var s=window.EC5.SITE_URL+"/api/internal/exists/"+r;e.removeClass("hidden"),clearTimeout(t),t=setTimeout(function(){window.EC5.projectCreate.doesProjectExist(s)},500)}}else e.addClass("hidden"),window.EC5.projectCreate.toggleGroupValidation(n,!1,"Please remove invalid chars")}),$(".page-create-project #form-name").keyup(function(e){var a=/^[\w\-\s]+$/,t=$(this),n=t.val(),o=$("#form-name-form-group");a.test(n)||""===n?window.EC5.projectCreate.toggleGroupValidation(o,!0):window.EC5.projectCreate.toggleGroupValidation(o,!1,"Please remove invalid chars")}),$(".page-create-project #small-description-form-group > input").keyup(function(e){var a=$("#small-description-form-group"),t=$(this),n=t.val();n.length>=15?window.EC5.projectCreate.toggleGroupValidation(a,!0):window.EC5.projectCreate.toggleGroupValidation(a,!1,"Must be at least 15 chars long")})}}),$(document).ready(function(){if($(".page-entries-deletion").length>0){var e=$(".page-entries-deletion").find(".project-name").text(),a=$(".delete-entries");a.submit(function(a){e.trim()!==$("#project-name").val().trim()&&a.preventDefault()}),a.on("keyup","#project-name",function(a){a.preventDefault(),$(".submit-delete-entries").attr("disabled",!(e.trim()===$(this).val().trim()))})}}),window.EC5=window.EC5||{},window.EC5.projectDetails=window.EC5.projectDetails||{},function(e){e.statusPairs={trashed:["restore","delete"],locked:["unlock"],active:["trashed","locked"]},e.currentSettingsValue=function(e){return window.EC5.projectDetails.parameters[e]||""},e.updateSettings=function(a){var t=e.currentSettingsValue(a),n=$(".settings-"+a);if("status"===a){var o=e.statusPairs[t]?e.statusPairs[t]:[];n.each(function(e,a){$(a).data("value")===t?$(this).addClass("btn-action"):$(this).removeClass("btn-action"),o.indexOf($(a).data("value"))!==-1||$(a).data("value")===t?$(this).removeClass("ec5-hide-block"):$(this).addClass("ec5-hide-block")})}n.each(function(e,a){$(a).data("value")===t?$(this).addClass("btn-action"):$(this).removeClass("btn-action")})},e.update=function(a,t){var n=window.EC5.SITE_URL+"/myprojects/"+window.EC5.projectDetails.parameters.slug+"/settings/"+a,o={};o[a]=t,$.when(window.EC5.projectUtils.postRequest(n,o)).done(function(t){try{$.each(t,function(e,a){window.EC5.projectDetails.parameters[e]=a}),e.updateSettings(a),window.EC5.toast.showSuccess("Setting updated.")}catch(n){window.EC5.projectUtils.showErrors(n)}}).fail(function(e){window.EC5.overlay.fadeOut(),window.EC5.projectUtils.showErrors(e)}).always(function(){window.EC5.overlay.fadeOut()})}}(window.EC5.projectDetails),$(document).ready(function(){$('[data-toggle="tooltip"]').tooltip();var e=$(".js-project-details");$(document).on("change",":file",function(){var e=$(this),a=e.get(0).files?e.get(0).files.length:1,t=e.val().replace(/\\/g,"/").replace(/.*\//,"");e.trigger("fileselect",[a,t])}),$(":file").on("fileselect",function(e,a,t){var n=$(this).parents(".input-group").find(":text"),o=a>1?a+" files selected":t;n.length&&n.val("    "+o)}),window.EC5.projectDetails.parameters={status:e.attr("data-js-status"),access:e.attr("data-js-access"),visibility:e.attr("data-js-visibility"),logo_url:e.attr("data-js-logo_url"),category:e.attr("data-js-category"),slug:e.attr("data-js-slug")},$(".btn-settings-submit").on("click",function(){var e=$(this),a=e.attr("data-setting-type"),t=e.attr("data-value");t!==window.EC5.projectDetails.currentSettingsValue(a)&&(window.EC5.overlay.fadeIn(),window.EC5.projectDetails.update(a,t))}),$(["access","status","visibility"]).each(function(e,a){window.EC5.projectDetails.updateSettings(a)}),$("#project-category").on("change",function(e){var a="category",t=$(this).val();t!==window.EC5.projectDetails.currentSettingsValue(a)&&(window.EC5.overlay.fadeIn(),window.EC5.projectDetails.update(a,t))}),$(".project-details__edit").on("click",function(){var e=$(this).parents(".panel");switch(window.EC5.overlay.fadeIn(),e.hide(),e.attr("id")){case"details-view":$("#details-edit").fadeIn(function(){window.EC5.overlay.fadeOut()});break;case"details-edit":$("#details-view").fadeIn(function(){window.EC5.overlay.fadeOut()})}}),$(".project-homepage-url .copy-btn").on("click",function(){var e=$(this);console.log(e.parent().find("a").text()),navigator.clipboard.writeText(e.parent().find("a").text()).then(function(){e.tooltip("show"),window.setTimeout(function(){e.tooltip("hide")},1500)},function(){})})}),$(document).ready(function(){var e=$(".manage-entries-limits__table"),a=$(".page-manage-entries #limits-form"),t=$(".page-manage-entries .limits-form__update-btn"),n=$(".page-manage-entries .bulk-upload-btns"),o=n.data("project-slug"),r=window.EC5.SITE_URL+"/api/internal/can-bulk-upload/"+o;e.on("change","td input:checkbox",function(){var e=$(this).parents("td").next().find("input.input__limit-to");this.checked?e.prop("disabled",!1):(e.val(""),e.prop("disabled",!0))}),t.on("click",function(){window.EC5.toast.clear(),a.find(".input__set-limit").each(function(){var e=$(this),a=e.parents("td").next().find("input.input__limit-to"),t=a.parent(),n=t.find(".form-control-feedback");n.addClass("hidden"),t.removeClass("has-error has-feedback")});var e=!0;a.find(".input__set-limit:checked").each(function(){var a=$(this),t=a.parents("td").next().find("input.input__limit-to"),n=t.parent(),o=n.find(".form-control-feedback");""===t.val()&&(n.addClass("has-error has-feedback"),o.removeClass("hidden"),e=!1)}),e?a.submit():window.EC5.toast.showError("Required fields missing!")}),a.on("submit",function(e){e.preventDefault(),$.ajax({url:"",type:"POST",dataType:"json",data:$(this).serializeArray()}).done(function(){window.EC5.toast.showSuccess("Updated.")}).fail(function(e){if(e.responseJSON&&e.responseJSON.errors&&e.responseJSON.errors.length>0){var a;for(a=0;a<e.responseJSON.errors.length;a++)window.EC5.toast.showError(e.responseJSON.errors[a].title)}})}),n.on("click",".btn",function(e){var a=$(this);window.EC5.overlay.fadeIn(),window.EC5.projectUtils.postRequest(r,{can_bulk_upload:$(this).data("bulk-upload")}).done(function(){n.find(".btn-action").removeClass("btn-action"),a.addClass("btn-action"),window.EC5.overlay.fadeOut(),window.EC5.toast.showSuccess("Settings updated.")}).fail(function(e){if(e.responseJSON.errors&&e.responseJSON.errors.length>0)for(var a=0;a<e.responseJSON.errors.length;a++)window.EC5.toast.showError(e.responseJSON.errors[a].title);window.EC5.overlay.fadeOut()})})}),$(document).ready(function(){if(0!==$(".page-manage-users").length){var e,a=$(".manage-project-users"),t="#creator",n=window.EC5.project_users.config;window.EC5.overlay.fadeIn(),$('a[data-toggle="tab"]').on("shown.bs.tab",function(e){var a=$(e.target).attr("href");t="page-"+a.substring(1),$(".manage-project-users__"+t).html(""),$.when(window.EC5.project_users.getProjectUsers(t,1)).then(function(e){$(".manage-project-users__"+t).hide().html(e).fadeIn(n.consts.ANIMATION_FAST)},function(e){e.responseJSON?window.EC5.toast.showError(e.responseJSON.errors[0].title):window.EC5.toast.showError(e),window.EC5.overlay.fadeOut()})}),$.when(window.EC5.project_users.getProjectUsers("page-creator").then(function(e){$(".manage-project-users__"+t).remove().html(e),window.EC5.overlay.fadeOut()},function(e){window.EC5.overlay.fadeOut()})),$(".page-manage-users .tab-content .panel-body").off().on("click",".manage-project-users__switch-role",function(){var e=$(this).data("project-slug"),a=$(this).data("user-role"),t=$(this).data("user-email"),o=$("#ec5SwitchUserRole");o.find(".user-email strong").text(t);var r=$.map(n.consts.ROLES,function(e){return e});$(r).each(function(e,a){o.find(".role-"+a).show()}),o.find(".role-"+a).hide(),o.find(".switch-role-confirm").attr("disabled",!0),o.find("input:radio").prop("checked",!1),o.modal("show"),o.on("shown.bs.modal",function(n){var r=null;o.find(".users__pick-role .radio label").off().on("click",function(){r=o.find(".users__pick-role").find(".radio input:checked").val(),o.find(".switch-role-confirm").attr("disabled",!1)}),o.find(".switch-role-confirm").off().on("click",function(){return null!==r&&(!(!e||!t)&&(window.EC5.overlay.fadeIn(),void $.when(window.EC5.project_users.switchUserRole(e,t,a,r)).done(function(e){var t="page-"+a;$.when(window.EC5.project_users.getProjectUsers(t,1).then(function(a){$(".manage-project-users__"+t).html(a),o.modal("hide"),window.EC5.toast.showSuccess(e.data.message),window.EC5.overlay.fadeOut()},function(e){window.EC5.overlay.fadeOut(),e.responseJSON?window.EC5.toast.showError(e.responseJSON.errors[0].title):window.EC5.toast.showError(e),o.modal("hide")}))}).fail(function(e){console.log(e),window.EC5.overlay.fadeOut(),e.responseJSON?window.EC5.toast.showError(e.responseJSON.errors[0].title):window.EC5.toast.showError(e),o.modal("hide")})))})})}),a.on("click",".pagination a",function(e){e.preventDefault(),window.EC5.overlay.fadeIn();var a=$(this).closest(".manage-project-users"),t=a.data("page-name"),n=a.find(".manage-project-users__user-search").val();$.when(window.EC5.project_users.getProjectUsers(t,$(this).attr("href").split("=")[1],n).then(function(e){$(".manage-project-users__"+t).html(e),window.EC5.overlay.fadeOut()},function(){window.EC5.overlay.fadeOut()}))}),a.on("keyup",".manage-project-users__user-search",function(a){var t=this.value;if(t.length>=0||13===a.keyCode){window.EC5.overlay.fadeIn();var n=$(this).closest(".manage-project-users"),o=n.data("page-name"),r=200;clearTimeout(e),e=setTimeout(function(){$.when(window.EC5.project_users.getProjectUsers(o,1,t).then(function(e){$(".manage-project-users__"+o).html(e),window.EC5.overlay.fadeOut()},function(){window.EC5.overlay.fadeOut()}))},r)}}),a.on("click",".manage-project-users__reset",function(e){window.EC5.overlay.fadeIn(),e.preventDefault();var a=$(this).closest(".manage-project-users"),t=a.data("page-name");$(".manage-project-users__user-search").val(""),$.when(window.EC5.project_users.getProjectUsers(t,1).then(function(e){$(".manage-project-users__"+t).html(e),window.EC5.overlay.fadeOut()},function(){window.EC5.overlay.fadeOut()}))}),a.on("submit",".manage-project-users__table__remove-form",function(e){e.preventDefault();var a=$(this).serializeArray(),t=$(this).attr("action"),n=$(this).closest(".manage-project-users"),o=n.data("page-name"),r=n.find(".pagination .active span").html(),i=n.find(".manage-project-users__user-search").val();window.EC5.project_users.removeUserProjectRole(t,a,o,r,i)}),$(".manage-project-users__existing-user-add-form").on("submit",function(e){e.preventDefault();var a=$(this).serializeArray(),t=$(this).attr("action"),n=a[1].value?"page-"+a[1].value:"page-creator";window.EC5.project_users.addUserProjectRole(t,a,n,function(){$("#ec5ModalExistingUser").find("input[type=email]").val(""),$("#ec5ModalExistingUser").modal("hide")})}),$(".manage-project-users__new-user-add-form").on("submit",function(e){e.preventDefault();var a=$(this).serializeArray(),t=$(".manage-project-users__existing-user-add-form").serializeArray(),n=a.concat(t),o=$(this).attr("action"),r=n[2]&&n[2].value?"page-"+n[2].value:"page-creator";window.EC5.project_users.addUserProjectRole(o,n,r,function(){$("#ec5ModalExistingUser").find("input[type=email]").val(""),$("#ec5ModalExistingUser").modal("hide"),$("#ec5ModalNewUser").modal("hide")})}),$(".manage-user-more__import-users").off().on("click",function(){var e=$(this);if(!window.EC5.project_users.isOpeningFileBrowser){var a=e.find(".manage-user-more__import-users__input-file");window.EC5.project_users.isOpeningFileBrowser=!0,a.off("change").on("change",function(){window.EC5.project_users.pickCSVFile(this.files),$(this).val(null)}),e.find(".manage-user-more__import-users__input-file").trigger("click")}window.setTimeout(function(){window.EC5.project_users.isOpeningFileBrowser=!1},3e3)}),$(".manage-user-more__export-users").off().on("click",function(){var e=$(this).find("a").data("project-slug");window.EC5.overlay.fadeIn(),$.when(window.EC5.project_users.exportUsersToCSV(e)).then(function(){window.EC5.overlay.fadeOut()},function(e){e.responseJSON?window.EC5.toast.showError(e.responseJSON.errors[0].title):window.EC5.toast.showError(e),window.EC5.overlay.fadeOut()})}),$(".manage-project-users__delete-by-role").off().on("click",function(){var e=$(this).data("project-slug"),a=$(this).data("role");window.EC5.overlay.fadeIn(),$.when(window.EC5.project_users.removeUsersByRole(e,a)).then(function(e){window.EC5.toast.showSuccess(e.data.message),$.when(window.EC5.project_users.getProjectUsers(t,1).then(function(e){$(".manage-project-users__"+t).html(e),window.EC5.overlay.fadeOut()},function(){window.EC5.overlay.fadeOut()}))},function(e){window.EC5.overlay.fadeOut(),e.responseJSON?window.EC5.toast.showError(e.responseJSON.errors[0].title):window.EC5.toast.showError(e)})})}}),window.EC5=window.EC5||{},$(document).ready(function(){var e=4,a=$(".page-mapping-data"),t=a.data("url");0!==a.length&&($(".form-list-selection").on("click","li",function(){var e=$(this),a=$(e).data("form-ref"),t=$(".map-data__tabs li.active").data("map-index"),n=$("#map-data-tabcontent-"+t+" .panel-body");e.parents(".form-list-selection").find(".dropdown-toggle .form-list-selection__form-name").text(e.text()),n.find(".table-responsive").fadeOut().addClass("hidden"),n.find('[data-form-ref="'+a+'"]').hide().removeClass("hidden").fadeIn()}),$(".map-data--actions__btns").on("click",'[data-toggle="push"]',function(){var e=$(this),a=e.data("action"),n=$(".map-data__tabs li.active"),o=$(".map-data__tabs li").not(".active").not(".map-data__tabs__add-form"),r=n.data("map-index"),i=n.data("map-name");switch(console.log(a),a){case"make-default":window.EC5.mapping.makeDefault(t,a,r,i,n,o);break;case"update":window.EC5.mapping.update(t,a,r,i)}}),$("#modal__mapping-data").on("show.bs.modal",function(a){var n=$(a.relatedTarget),o=n.data("action"),r=$(this),i=n.data("trans"),s=r.find(".map-data__modal__save-btn"),d=$(".map-data__tabs li.active"),c=!d.find(".map-data__default-pin").hasClass("invisible"),p=d.data("map-index"),l=d.data("map-name"),u=$(".page-mapping-data .tab-content");switch(r.find(".modal-title").text(i),o){case"delete":window.EC5.mapping["delete"](t,o,p,l,d,r,s,c,u);break;case"rename":window.EC5.mapping.rename(t,o,p,l,d,r,s);break;case"add-mapping":window.EC5.mapping.addMapping(t,r,s,e,u,u)}}))}),window.EC5=window.EC5||{},window.EC5.projectUtils=window.EC5.projectUtils||{},function(e){e.postRequest=function(e,a){return $.ajax({url:e,contentType:"application/vnd.api+json",data:JSON.stringify(a),dataType:"json",method:"POST",crossDomain:!0})},e.showErrors=function(e){var a="";$(e.responseJSON.errors).each(function(e,t){a+=t.title+"<br/>"}),window.EC5.toast.showError(a)}}(window.EC5.projectUtils),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.addUserProjectRole=function(a,t,n,o){var r;$.ajax({url:a,type:"POST",dataType:"json",data:t}).done(function(a){window.EC5.toast.showSuccess(a.data.message),$.when(e.getProjectUsers(n,1)).then(function(e){var a=n.replace("page-","");$(".manage-project-users__"+n).html(e),$(".page-manage-users .nav-tabs li").find("a."+a+"-tab-btn").trigger("click"),o&&o()})}).fail(function(e){var a="ec5_90";if(e.responseJSON.errors&&e.responseJSON.errors.length>0)for(r=0;r<e.responseJSON.errors.length;r++)e.responseJSON.errors[r].code===a?$("#ec5ModalNewUser").modal():window.EC5.toast.showError(e.responseJSON.errors[r].title)})}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.config={messages:{error:{CSV_FILE_INVALID:"CSV file is invalid",INVALID_EMAILS:"Invalid emails",BROWSER_NOT_SUPPORTED:"Browser not supported"},success:{USERS_IMPORTED:"Users added to the project"},warning:{SOME_USERS_NOT_IMPORTED:"Some users could not be imported"}},consts:{CSV_FILE_EXTENSION:"csv",ANIMATION_FAST:200,ANIMATION_NORMAL:500,ROLES:{MANAGER:"manager",CURATOR:"curator",COLLECTOR:"collector",VIEWER:"viewer"}},errorCodes:{userDoesntExist:"ec5_90",importerDoesNotHavePermission:"ec5_91",invalidValue:"ec5_29",invalidEmailAddress:"ec5_42",creatorEmailAddress:"ec5_217",managerEmailAddress:"ec5_344"},invalidEmailAddresses:[]}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.exportUsersToCSV=function(e){var a=this,t=a.config,n=new $.Deferred,o=window.EC5.SITE_URL+"/api/internal/project-users/"+e;return $.ajax({url:o,type:"GET",dataType:"json"}).done(function(a){var o={all:[],creators:[],managers:[],curators:[],collectors:[],viewers:[]},r={all:"",creators:"",managers:"",curators:"",collectors:"",viewers:""};$(a.data).each(function(e,a){switch(o.all.push(a),a.role){case"creator":o.creators.push(a);break;case"manager":o.managers.push(a);break;case"curator":o.curators.push(a);break;case"collector":o.collectors.push(a);break;case"viewer":o.viewers.push(a)}}),$.each(o,function(e){r[e]=Papa.unparse({data:o[e]},{quotes:!1,quoteChar:"",delimiter:",",header:!0,newline:"\r\n"})});var i=new JSZip;$.each(r,function(e,a){i.file(e+".csv",a)}),i.generateAsync({type:"blob"}).then(function(a){try{saveAs(a,e+"_users.zip"),n.resolve()}catch(o){console.log(o),n.reject(t.messages.error.BROWSER_NOT_SUPPORTED)}})}).fail(function(e){n.reject(e)}),n.promise()}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.getProjectUsers=function(e,a,t){var n=new $.Deferred,o={};return a="undefined"!=typeof a?a:1,t="undefined"!=typeof t?t:"",o[e]=a,o.search=t,$.ajax({url:"",type:"GET",dataType:"json",data:o}).done(function(e){n.resolve(e)}).fail(function(e){n.reject(e)}),n.promise()}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){function a(e){var a=/^([a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+(\.[a-z\d!#$%&'*+\-\/=?^_`{|}~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+)*|"((([ \t]*\r\n)?[ \t]+)?([\x01-\x08\x0b\x0c\x0e-\x1f\x7f\x21\x23-\x5b\x5d-\x7e\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|\\[\x01-\x09\x0b\x0c\x0d-\x7f\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))*(([ \t]*\r\n)?[ \t]+)?")@(([a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\d\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.)+([a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]|[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF][a-z\d\-._~\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]*[a-z\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])\.?$/i;return a.test(e)}e.importUsersByEmail=function(e){var t=[],n=e.selectedHeaderIndex,o=e.importedJson,r=o.meta.fields,i=e.doesFirstRowContainsHeaders,s=e.selectedUserRole,d=e.postURL,c=new $.Deferred,p=window.EC5.project_users.config;if(p.invalidEmailAddresses=[],null===n)return!1;if(!i){var l={};l[o.meta.fields[n]]=o.meta.fields[n],o.data.unshift(l)}$(o.data).each(function(e,o){var i=o[r[n]];""!==i.trim()&&(a(i)?t.push(i):p.invalidEmailAddresses.push(i))});var u={role:s,emails:$.unique(t).slice(0,100)};return $.ajax({url:d,type:"POST",dataType:"json",data:u}).done(function(e){c.resolve(e)}).fail(function(e){c.reject(e)}),c.promise()}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.pickCSVFile=function(e){function a(e){var a="";return e.responseJSON?$.each(e.responseJSON.errors,function(e,t){a+=t.title+"<br/>"}):a=e,a}var t,n,o=this,r=e[0],i=o.config;if(window.EC5.overlay.fadeIn(),o.isOpeningFileBrowser=!1,!r)return window.EC5.overlay.fadeOut(i.consts.ANIMATION_FAST),void window.EC5.toast.showError(i.messages.error.CSV_FILE_INVALID);if(t=r.name.split("."),n=t[t.length-1],n!==i.consts.CSV_FILE_EXTENSION)return window.EC5.overlay.fadeOut(i.consts.ANIMATION_FAST),void window.EC5.toast.showError(i.messages.error.CSV_FILE_INVALID);var s=new FileReader;s.onload=function(e){var t=e.target.result,n=Papa.parse(t,{header:!0,delimiter:","}),r=n.meta.fields,s=$("#ec5ModalImportUsers");return 0===n.data.length?(window.EC5.overlay.fadeOut(i.consts.ANIMATION_FAST),void window.EC5.toast.showError(i.messages.error.CSV_FILE_INVALID)):(s.modal(),s.off().on("shown.bs.modal",function(){var e,t,d,c=s.find(".users-column-picker"),p="",l=null,u=s.data("post-url");c.find(".btn").html('Pick column <span class="caret"></span>'),c.find(".btn").val(""),s.find(".users__first-row-headers input").prop("checked",!0),s.find(".users__pick-role input#collector").prop("checked",!0),s.find(".users-perform-import").attr("disabled",!0),window.EC5.overlay.fadeOut(i.consts.ANIMATION_FAST),$(r).each(function(e,a){p+="<li>",p+='<a href="#">'+a.trunc(25)+"</a>",p+="</li>"}),c.find(".dropdown-menu").empty().append(p),c.find(".dropdown-menu li").off().on("click",function(){$(this).parents(".users-column-picker").find(".btn").html($(this).text()+' <span class="caret"></span>'),$(this).parents(".users-column-picker").find(".btn").val($(this).data("value")),l=$(this).index(),s.find(".users-perform-import").attr("disabled",!1)}),$(".users-perform-import").off().on("click",function(){return null!==l&&(window.EC5.overlay.fadeIn(),t=s.find(".users__first-row-headers").find(".checkbox input").is(":checked"),d=s.find(".users__pick-role").find(".radio input:checked").val(),e={doesFirstRowContainsHeaders:t,selectedUserRole:d,importedJson:n,selectedHeaderIndex:l,postURL:u},void window.setTimeout(function(){console.log("imported"),$.when(o.importUsersByEmail(e)).then(function(e){var a="page-"+d;$.when(window.EC5.project_users.getProjectUsers(a,1,"").then(function(e){$(".manage-project-users__"+a).html(e),$(".page-manage-users .nav-tabs li").find("a."+d+"-tab-btn").trigger("click"),window.EC5.overlay.fadeOut(),$("#ec5ModalImportUsers").modal("hide"),i.invalidEmailAddresses.length>0?(window.EC5.toast.showWarning(i.messages.warning.SOME_USERS_NOT_IMPORTED),window.EC5.toast.showError(i.messages.error.INVALID_EMAILS+": <br/>"+i.invalidEmailAddresses.join("<br/>"))):window.EC5.toast.showSuccess(i.messages.success.USERS_IMPORTED)},function(){window.EC5.overlay.fadeOut()}))},function(e){var t="page-"+d;$.when(window.EC5.project_users.getProjectUsers(t,1,"").then(function(n){$(".manage-project-users__"+t).html(n),$(".page-manage-users .nav-tabs li").find("a."+d+"-tab-btn").trigger("click"),window.EC5.overlay.fadeOut(),$("#ec5ModalImportUsers").modal("hide"),window.EC5.toast.showError(a(e)),i.invalidEmailAddresses.length>0&&(window.EC5.toast.showWarning(i.messages.warning.SOME_USERS_NOT_IMPORTED),window.EC5.toast.showError(i.messages.error.INVALID_EMAILS+": <br/>"+i.invalidEmailAddresses.join("<br/>")))},function(){window.EC5.overlay.fadeOut()}))})},1e3))})}),void s.find('button[data-dismiss="modal"]').one("click",function(){s.modal("hide")}))},s.readAsText(r)}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.removeUserProjectRole=function(a,t,n,o,r){var i,s=window.EC5.project_users.config,d=t.length,c={};for(window.EC5.overlay.fadeIn(),i=0;i<d;i++)c[t[i].name]=t[i].value;var p=c["total-users"]-1;0===p&&(o-=1),$.ajax({url:a,type:"POST",dataType:"json",data:t,page:o}).done(function(a){$.when(e.getProjectUsers(n,o,r)).then(function(e){$(".manage-project-users__"+n).html(e),window.setTimeout(function(){window.EC5.toast.showSuccess(a.data.message),window.EC5.overlay.fadeOut()},s.consts.ANIMATION_NORMAL)},function(e){window.setTimeout(function(){if(e.responseJSON.errors&&e.responseJSON.errors.length>0)for(i=0;i<e.responseJSON.errors.length;i++)window.EC5.toast.showError(e.responseJSON.errors[i].title);window.EC5.overlay.fadeOut()},s.consts.ANIMATION_NORMAL)})}).fail(function(e){window.setTimeout(function(){if(e.responseJSON.errors&&e.responseJSON.errors.length>0)for(i=0;i<e.responseJSON.errors.length;i++)window.EC5.toast.showError(e.responseJSON.errors[i].title);window.EC5.overlay.fadeOut()},s.consts.ANIMATION_NORMAL)})}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.removeUsersByRole=function(e,a){var t=new $.Deferred,n=window.EC5.SITE_URL+"/api/internal/project-users/"+e+"/remove-by-role";return $.ajax({url:n,type:"POST",dataType:"json",data:{role:a}}).done(function(e){var n="page-"+a;$(".manage-project-users__"+n).html(""),t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.project_users=window.EC5.project_users||{},function(e){e.switchUserRole=function(e,a,t,n){var o=window.EC5.SITE_URL+"/api/internal/project-users/"+e+"/switch-role",r=window.EC5.project_users.config,i=$.map(r.consts.ROLES,function(e){return e}),s=new $.Deferred;$.inArray(t,i)!==-1&&$.inArray(n,i)!==-1||s.reject("Invalid role!"),t===n&&s.reject("Old role and new role are the same!");var d={email:a,currentRole:t,newRole:n};return $.ajax({url:o,type:"POST",dataType:"json",data:d}).done(function(e){console.log(e),s.resolve(e)}).fail(function(e){console.log(e),s.reject(e)}),s.promise()}}(window.EC5.project_users),window.EC5=window.EC5||{},window.EC5.mapping=window.EC5.mapping||{},function(e){e.addMapping=function(e,a,t,n,o){a.find(".map-data__modal__mapping-name").show(),a.find(".map-data__modal-delete-warning").addClass("hidden"),a.find("map-data__modal__name-rules").removeClass("hidden"),a.find(".map-data__modal__mapping-name").val(""),t.off().on("click",function(){window.EC5.toast.clear();var t=a.find(".map-data__modal__mapping-name").val();window.EC5.projectUtils.postRequest(e,{name:t,is_default:!1}).done(function(e){console.log(e),window.EC5.toast.showSuccess(t+" mapping added");var r=e.data.map_index,i='<li role="presentation" data-map-index="'+r+'" data-map-name="'+t+'">';i+=' <a href="#map-data-tabcontent-'+r+'" role="tab" data-toggle="tab">',i+='<span class="map-data__map-name">'+t+"&nbsp;</span>",i+='<i class="fa fa-thumb-tack invisible" aria-hidden="true"></i>',i+="</a>",i+="</li>",$(".map-data__tabs li").not(".map-data__tabs__add-form").last().after(i),$.isArray(e.data.mapping)?e.data.mapping.length===n&&$(".map-data__tabs li.map-data__tabs__add-form").addClass("hidden"):Object.keys(e.data.mapping).length===n&&$(".map-data__tabs li.map-data__tabs__add-form").addClass("hidden");var s=o.find("#map-data-tabcontent-0").clone(!0,!0);s.attr("id","map-data-tabcontent-"+r),s.attr("data-map-index",r),s.attr("data-map-name",t),s.find("[data-map-index]").each(function(e,a){$(a).attr("data-map-index",r)}),s.find(".map-data--actions__btns .btn").each(function(e,a){$(a).prop("disabled",!1)}),s.find(".table-responsive").each(function(e,a){var t=$(a).find("tr td input");t.prop("disabled",!1).prop("readonly",!1)}),o.append(s),$(".map-data__tabs li.active").removeClass("active"),$('.page-mapping-data .tab-content .tab-pane[data-map-index="0"]').removeClass("active in"),$('.map-data__tabs li[data-map-index="'+r+'"]').addClass("active"),$('.map-data__tabs li[data-map-index="'+r+'"] a').tab("show"),window.setTimeout(function(){a.modal("hide")},250)}).fail(function(e){console.log(e),window.EC5.projectUtils.showErrors(e)})})}}(window.EC5.mapping),window.EC5=window.EC5||{},window.EC5.mapping=window.EC5.mapping||{},function(e){e["delete"]=function(e,a,t,n,o,r,i,s,d){r.find(".map-data__modal__mapping-name").hide(),r.find(".map-data__modal-delete-warning").removeClass("hidden"),r.find("map-data__modal__name-rules").addClass("hidden"),i.off().on("click",function(){window.EC5.toast.clear(),window.EC5.projectUtils.postRequest(e+"/delete",{map_index:t}).done(function(e){var a=$(".map-data__tabs");window.EC5.toast.showSuccess(n+" deleted"),o.remove(),d.find("#map-data-tabcontent-"+t).remove(),a.find('a[href="#map-data-tabcontent-0"]').tab("show"),s&&a.find(".map-data__default-pin").first().removeClass("invisible"),$(".map-data__tabs li.map-data__tabs__add-form").removeClass("hidden"),r.modal("hide")}).fail(function(e){console.log(e),window.EC5.projectUtils.showErrors(e)})})}}(window.EC5.mapping),window.EC5=window.EC5||{},window.EC5.mapping=window.EC5.mapping||{},function(e){e.getDefaultMapIndex=function(){var e=0,a=$(".map-data__tabs li");return a.each(function(a,t){var n=$(t).attr("data-map-index");if(!$(t).find(".map-data__default-pin").hasClass("invisible"))return e=n,!1}),parseInt(e,10)}}(window.EC5.mapping),window.EC5=window.EC5||{},window.EC5.mapping=window.EC5.mapping||{},function(e){e.makeDefault=function(e,a,t,n,o,r){window.EC5.toast.clear(),window.EC5.projectUtils.postRequest(e+"/update",{action:a,map_index:t}).done(function(e){console.log(JSON.stringify(e)),window.EC5.toast.showSuccess(n+" set as default"),o.find(".map-data__default-pin").removeClass("invisible"),
r.each(function(e,a){$(a).find(".map-data__default-pin").addClass("invisible")})}).fail(function(e){window.EC5.projectUtils.showErrors(e)})}}(window.EC5.mapping),window.EC5=window.EC5||{},window.EC5.mapping=window.EC5.mapping||{},function(e){e.rename=function(e,a,t,n,o,r,i){r.find(".map-data__modal__mapping-name").show(),r.find(".map-data__modal-delete-warning").addClass("hidden"),r.find("map-data__modal__name-rules").removeClass("hidden"),r.find(".map-data__modal__mapping-name").val(n),i.off().on("click",function(){window.EC5.toast.clear();var n=r.find(".map-data__modal__mapping-name").val();window.EC5.projectUtils.postRequest(e+"/update",{action:a,map_index:t,name:n}).done(function(e){o.attr("data-map-name",n),o.find(".map-data__map-name").text(n),r.modal("hide"),window.EC5.toast.showSuccess(n+" renamed")}).fail(function(e){console.log(e),window.EC5.projectUtils.showErrors(e)})})}}(window.EC5.mapping),window.EC5=window.EC5||{},window.EC5.mapping=window.EC5.mapping||{},function(e){e.update=function(e,a,t,n){window.EC5.toast.clear(),window.EC5.overlay.fadeIn();var o={},r=$('.page-mapping-data .tab-content .tab-pane[data-map-index="'+t+'"]'),i=!0,s=null,d={},c=/^[a-zA-Z0-9_]{1,20}$/,p=/^((?![<>]).){1,150}$/,l=r.find(".panel-body .table-responsive");r.find("input").parent().removeClass("has-error"),o[t]={},o[t].name=n,o[t].forms={},o[t].map_index=t,o[t].is_default=window.EC5.mapping.getDefaultMapIndex()===t,l.each(function(e,a){var n=o[t],r=$(a).attr("data-form-ref"),l=$(a).find("tbody tr"),u=0;for(d[r]=[],n.forms[r]={};u<l.length;){var w=n.forms[r],f=$(l[u]).attr("data-input-ref"),m=$(l[u]).find(".mapping-data__map-to input"),h=m.val(),_=$(l[u]).find(".mapping-data__hide-checkbox input").is(":checked");if(h=void 0===h?void 0:h.trim(),f){switch(w[f]={},w[f].possible_answers={},w[f].branch={},w[f].group={},w[f].map_to=h,w[f].hide=_,void 0!==h&&d[r].push(h),h.match(c)||(i=!1,$(l[u]).find(".mapping-data__map-to input").parent().addClass("has-error")),$(l[u]).attr("data-input-type")){case"branch":var E=$(l[u]).nextUntil("[data-top-level-input]","[data-is-branch-input]");w[f].branch={},$(E).each(function(e,a){var t,n=$(a).attr("data-input-ref"),o=$(a).find(".mapping-data__map-to input"),s=o.val(),l=$(a).find(".mapping-data__hide-checkbox input").is(":checked");if(s=void 0===s?void 0:s.trim(),n){if(w[f].branch[n]={},t=w[f].branch[n],t.possible_answers={},t.branch={},t.group={},t.map_to=s,t.hide=l,void 0!==s&&d[r].push(s),s.match(c)||(i=!1,$(a).find(".mapping-data__map-to input").parent().addClass("has-error")),"group"===$(a).attr("data-input-type")){var m=$(a).nextUntil("[data-is-branch-input], [data-top-level-input]","[data-is-group-input]");t.group={},$(m).each(function(e,a){var o=$(a).attr("data-input-ref"),s=$(a).find(".mapping-data__map-to input"),l=s.val(),u=$(a).find(".mapping-data__hide-checkbox input").is(":checked");l=void 0===l?void 0:l.trim(),o?(t.group[o]={},t.group[o].possible_answers={},t.group[o].branch={},t.group[o].group={},t.group[o].map_to=l,t.group[o].hide=u,void 0!==l&&d[r].push(l),l.match(c)||(i=!1,$(a).find(".mapping-data__map-to input").parent().addClass("has-error"))):$(a).find(".mapping-data__possible_answer__map-to input").each(function(e,t){var o=$(a).prev().attr("data-input-ref"),r=w[f].branch[n].group[o],s=$(t).attr("data-answer-ref"),d=$(t).val();d=void 0===d?void 0:d.trim(),d.match(p)||(i=!1,$(t).parent().addClass("has-error")),r.possible_answers[s]={},r.possible_answers[s].map_to=d})}),u+=m.length}}else $(a).find(".mapping-data__possible_answer__map-to input").each(function(e,t){var n=$(a).prev().attr("data-input-ref"),o=w[f].branch[n],r=$(t).attr("data-answer-ref"),s=$(t).val();s=void 0===s?void 0:s.trim(),s.match(p)||(i=!1,$(t).parent().addClass("has-error")),o.possible_answers[r]={},o.possible_answers[r].map_to=s})}),u+=E.length;break;case"group":var C=$(l[u]).nextUntil("[data-top-level-input]","[data-is-group-input]");$(C).each(function(e,a){var t,n=$(a).attr("data-input-ref"),o=$(a).find(".mapping-data__map-to input"),s=o.val();s=void 0===s?void 0:s.trim();var l=$(a).find(".mapping-data__hide-checkbox input").is(":checked");n?(w[f].group[n]={},t=w[f].group[n],t.possible_answers={},t.branch={},t.group={},t.map_to=s,t.hide=l,void 0!==s&&d[r].push(s),s.match(c)||(i=!1,$(a).find(".mapping-data__map-to input").parent().addClass("has-error"))):$(a).find(".mapping-data__possible_answer__map-to input").each(function(e,t){var n=$(a).prev().attr("data-input-ref"),o=w[f].group[n],r=$(t).attr("data-answer-ref"),s=$(t).val();s=void 0===s?void 0:s.trim(),s.match(p)||(i=!1,$(t).parent().addClass("has-error")),o.possible_answers[r]={},o.possible_answers[r].map_to=s})}),u+=C.length}u++}else $(l[u]).find(".mapping-data__possible_answer__map-to input").each(function(e,a){var t=$(l[u-1]).attr("data-input-ref"),n=$(a).attr("data-answer-ref"),o=$(a).val();o=void 0===o?void 0:o.trim(),o.match(p)||(i=!1,$(a).parent().addClass("has-error")),w[t].possible_answers[n]={},w[t].possible_answers[n].map_to=o}),u++}console.log(JSON.stringify(d)),$.each(d,function(e,a){var t=[];$.each(a,function(a,n){return $.inArray(n.trim(),t)!==-1?(s={key:n,formRef:e},i=!1,console.log(n),!1):void t.push(n.trim())})})}),console.log(JSON.stringify(o[t])),i?window.EC5.projectUtils.postRequest(e+"/update",{action:a,map_index:t,mapping:o[t]}).done(function(e){window.EC5.overlay.fadeOut(),window.EC5.toast.showSuccess(n+" updated")}).fail(function(e){window.EC5.overlay.fadeOut(),window.EC5.projectUtils.showErrors(e)}):(s?(l.each(function(e,a){if($(a).data("form-ref")===s.formRef){var t=$(a).find("tbody tr");t.each(function(e,a){$(a).find(".mapping-data__map-to input").val()===s.key&&$(a).find(".mapping-data__map-to").addClass("has-error")})}}),window.EC5.toast.showError(n+" has got duplicate identifier: "+s.key)):window.EC5.toast.showError(n+" has got invalid identifier(s)"),window.EC5.overlay.fadeOut())}}(window.EC5.mapping);