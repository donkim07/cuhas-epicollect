"use strict";window.EC5=window.EC5||{},window.EC5.admin=window.EC5.admin||{},window.EC5.admin.projects=window.EC5.admin.projects||{},function(e){e.updateRole=function(e,i){$.ajax({url:window.EC5.SITE_URL+"/admin/update-user-project-role",type:"POST",dataType:"json",data:{role:e,project_id:i}}).done(function(e){window.EC5.toast.showSuccess(e.data.title)}).fail(window.EC5.showError)},e.getProjects=function(e){var i=new $.Deferred;return console.log(e),$.ajax({url:e.url,type:"GET",dataType:"json",data:e}).done(function(e){i.resolve(e)}).fail(function(e){i.reject(e)}),i.promise()}}(window.EC5.admin.projects),$(document).ready(function(){function e(e){e.preventDefault();var t=l.data("selected-value"),n=d.data("selected-value");a.page=$(e.target).attr("href").split("page=")[1],a.name=s.val().trim(),a.access="any"===n?"":n,a.visibility="any"===t?"":t,i(0)}function i(i){p.removeClass("hidden"),f.find(".projects__table__wrapper").empty(),r(function(){window.EC5.admin.projects.getProjects(a).then(function(i){p.addClass("hidden"),f.hide().append(i).fadeIn(500),$(".pagination").on("click","a",e)},function(e){console.log(e)})},i)}var t=$(".url").data("js"),n=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},r=function(){var e=0;return function(i,t){clearTimeout(e),e=setTimeout(i,t)}}(),a={url:t,page:1,name:"",access:"",visibility:""},s=$(".page-admin .projects-list__filter-controls .projects-list__project-search"),o=$(" .page-admin .projects-list__filter-controls_dropdowns"),d=o.find(".filter-controls__access .dropdown-toggle"),u=o.find(".filter-controls__access .dropdown-menu"),l=o.find(".filter-controls__visibility .dropdown-toggle"),c=o.find(".filter-controls__visibility .dropdown-menu"),f=$(" .page-admin .projects-list"),p=$(".page-admin .projects-loader");f.on("change",".project-roles",function(){var e=$(this).data("projectId"),i=$(this).val();window.EC5.admin.projects.updateRole(i,e)}),s.keyup(function(){a.name=$(this).val().trim();var e=d.data("selected-value"),t=l.data("selected-value");a.access="any"===e?"":e,a.visibility="any"===t?"":t,i(500)}),u.on("click","li",function(){var e=$(this).data("filter-value");a.access="any"===e?"":e,d.data("selected-value",e),d.parent().find(".dropdown-text").text(n(e)),console.log(a),i(0)}),c.on("click","li",function(){var e=$(this).data("filter-value");a.visibility="any"===e?"":e,l.data("selected-value",e),l.parent().find(".dropdown-text").text(n(e)),i(0)}),$(".pagination").on("click","a",e)}),window.EC5=window.EC5||{},window.EC5.users=window.EC5.users||{},function(e){e.showError=function(e){if(e.responseJSON.errors&&e.responseJSON.errors.length>0){var i;for(i=0;i<e.responseJSON.errors.length;i++)window.EC5.toast.showError(e.responseJSON.errors[i].title)}},e.getUsers=function(i,t,n,r){i="undefined"!=typeof i?i:1,t="undefined"!=typeof t?t:"",n="undefined"!=typeof n?n:"",r="undefined"!=typeof r?r:"",$.ajax({url:window.EC5.SITE_URL+"/admin",type:"GET",dataType:"json",data:{page:i,search:t,filter:n,filterOption:r}}).done(function(e){$(".user-administration__users").html(e)}).fail(e.showError)},e.updateUser=function(i,t){$.ajax({url:i,type:"POST",dataType:"json",data:t}).done(function(){var i=$(".user-administration"),t=i.find(".user-administration__user-search").val(),n=i.find(".user-administration__user-filter").val(),r=i.find(".user-administration__user-filter-option").val(),a=i.find(".pagination .active span").html();e.getUsers(a,t,n,r)}).fail(e.showError)},e.addUser=function(i,t,n){$.ajax({url:i,type:"POST",dataType:"json",data:t}).done(function(){window.EC5.toast.showSuccess("New User added."),e.getUsers(),n&&n()}).fail(e.showError)}}(window.EC5.users),$(document).ready(function(){var e=$(".user-administration"),i=$("#ec5ModalAddUser");e.on("click",".pagination a",function(e){e.preventDefault();var i=$(this).closest(".user-administration"),t=i.find(".user-administration__user-search").val(),n=i.find(".user-administration__user-filter").val(),r=i.find(".user-administration__user-filter-option").val();window.EC5.users.getUsers($(this).attr("href").split("page=")[1],t,n,r),window.scrollTo(0,0)});var t;e.on("keyup",".user-administration__user-search",function(e){var i=this.value;if(this.value.length>=0||13===e.keyCode){var n=$(this).closest(".user-administration"),r=n.find(".user-administration__user-filter").val(),a=n.find(".user-administration__user-filter-option").val(),s=200;clearTimeout(t),t=setTimeout(function(){window.EC5.users.getUsers(1,i,r,a)},s)}});var n={active:"Active",disabled:"Disabled"},r={basic:"Basic",admin:"Admin",superadmin:"Superadmin"};e.on("change",".user-administration__user-filter",function(e){var i=$(this).closest(".user-administration"),t=$(".user-administration__user-filter-option");switch(t.children("option:not(:first)").remove(),this.value){case"state":$.each(n,function(e,t){i.find(".user-administration__user-filter-option").append($("<option/>",{value:e,text:t}))}),t.prop("disabled",!1);break;case"server_role":$.each(r,function(e,i){$(".user-administration__user-filter-option").append($("<option/>",{value:e,text:i}))}),t.prop("disabled",!1);break;default:t.prop("disabled",!0);var a=$(".user-administration__user-search").val();window.EC5.users.getUsers(1,a)}}),e.on("change",".user-administration__user-filter-option",function(e){var i=$(this).closest(".user-administration"),t=i.find(".user-administration__user-search").val(),n=i.find(".user-administration__user-filter").val();window.EC5.users.getUsers(1,t,n,this.value)}),e.on("click",".user-administration__user-reset",function(e){e.preventDefault();var i=$(this).closest(".user-administration");i.find(".user-administration__user-search").val(""),i.find(".user-administration__user-filter").val(i.find(".user-administration__user-filter option:first").val()),i.find(".user-administration__user-filter-option").children("option:not(:first)").remove(),i.find(".user-administration__user-filter-option").prop("disabled",!0),window.EC5.users.getUsers()}),e.on("submit",".user-administration__table__state-form",function(e){e.preventDefault();var i=$(this).serialize(),t=$(this).attr("action");window.EC5.users.updateUser(t,i)}),e.on("submit",".user-administration__table__server-role-form",function(e){e.preventDefault();var i=$(this).serialize(),t=$(this).attr("action");window.EC5.users.updateUser(t,i)}),$(".manage-users__user-add-form").on("submit",function(e){e.preventDefault();var i=$(this).serialize(),t=$(this).attr("action");window.EC5.users.addUser(t,i,function(){$("#ec5ModalAddUser").modal("hide")})}),i.find(".show-password-control").on("click",function(){$(this).prop("checked")?i.find("input.password-input").each(function(){$(this).attr("type","text")}):i.find("input.password-input").each(function(e){$(this).attr("type","password")})})});