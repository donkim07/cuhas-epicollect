"use strict";window.EC5=window.EC5||{},window.EC5.admin=window.EC5.admin||{},window.EC5.admin.projects=window.EC5.admin.projects||{},function(e){e.updateRole=function(e,t){$.ajax({url:window.EC5.SITE_URL+"/admin/update-user-project-role",type:"POST",dataType:"json",data:{role:e,project_id:t}}).done(function(e){window.EC5.toast.showSuccess(e.data.title)}).fail(window.EC5.showError)},e.getProjects=function(e){var t=new $.Deferred;return console.log(e),$.ajax({url:e.url,type:"GET",dataType:"json",data:e}).done(function(e){t.resolve(e)}).fail(function(e){t.reject(e)}),t.promise()}}(window.EC5.admin.projects),$(document).ready(function(){function e(e){e.preventDefault();var i=l.data("selected-value"),n=d.data("selected-value");a.page=$(e.target).attr("href").split("page=")[1],a.name=s.val().trim(),a.access="any"===n?"":n,a.visibility="any"===i?"":i,t(0)}function t(t){p.removeClass("hidden"),f.find(".projects__table__wrapper").empty(),r(function(){window.EC5.admin.projects.getProjects(a).then(function(t){p.addClass("hidden"),f.hide().append(t).fadeIn(500),$(".pagination").on("click","a",e)},function(e){console.log(e)})},t)}var i=$(".url").data("js"),n=function(e){return e.charAt(0).toUpperCase()+e.slice(1)},r=function(){var e=0;return function(t,i){clearTimeout(e),e=setTimeout(t,i)}}(),a={url:i,page:1,name:"",access:"",visibility:""},s=$(".page-admin .projects-list__filter-controls .projects-list__project-search"),o=$(" .page-admin .projects-list__filter-controls_dropdowns"),d=o.find(".filter-controls__access .dropdown-toggle"),u=o.find(".filter-controls__access .dropdown-menu"),l=o.find(".filter-controls__visibility .dropdown-toggle"),c=o.find(".filter-controls__visibility .dropdown-menu"),f=$(" .page-admin .projects-list"),p=$(".page-admin .projects-loader");f.on("change",".project-roles",function(){var e=$(this).data("projectId"),t=$(this).val();window.EC5.admin.projects.updateRole(t,e)}),s.keyup(function(){a.name=$(this).val().trim();var e=d.data("selected-value"),i=l.data("selected-value");a.access="any"===e?"":e,a.visibility="any"===i?"":i,t(500)}),u.on("click","li",function(){var e=$(this).data("filter-value");a.access="any"===e?"":e,d.data("selected-value",e),d.parent().find(".dropdown-text").text(n(e)),console.log(a),t(0)}),c.on("click","li",function(){var e=$(this).data("filter-value");a.visibility="any"===e?"":e,l.data("selected-value",e),l.parent().find(".dropdown-text").text(n(e)),t(0)}),$(".pagination").on("click","a",e)}),window.EC5=window.EC5||{},window.EC5.users=window.EC5.users||{},function(e){e.showError=function(e){if(e.responseJSON.errors&&e.responseJSON.errors.length>0){var t;for(t=0;t<e.responseJSON.errors.length;t++)window.EC5.toast.showError(e.responseJSON.errors[t].title)}},e.getUsers=function(t,i,n,r){window.setTimeout(function(){window.EC5.overlay.fadeIn()},500),$(".user-administration__users").find(".user-administration__table").animate({opacity:0},500),t="undefined"!=typeof t?t:1,i="undefined"!=typeof i?i:"",n="undefined"!=typeof n?n:"",r="undefined"!=typeof r?r:"",$.ajax({url:window.EC5.SITE_URL+"/admin/users",type:"GET",dataType:"json",data:{page:t,search:i,server_role:n,state:r}}).done(function(e){$(".user-administration__users").html(e).animate({opacity:1},500)}).fail(e.showError).always(function(){window.EC5.overlay.fadeOut()})},e.updateUser=function(t,i){$.ajax({url:t,type:"POST",dataType:"json",data:i}).done(function(){var t=$(".user-administration"),i=t.find(".user-administration__user-search").val(),n=t.find(".user-administration__user-filter__server-role").val(),r=t.find(".user-administration__user-filter__state").val(),a=t.find(".pagination .active span").html();e.getUsers(a,i,n,r)}).fail(e.showError)},e.addUser=function(t,i,n){$.ajax({url:t,type:"POST",dataType:"json",data:i}).done(function(){window.EC5.toast.showSuccess("New User added."),e.getUsers(),n&&n()}).fail(e.showError)}}(window.EC5.users),$(document).ready(function(){var e=$(".user-administration"),t=$("#ec5ModalAddUser");e.on("click",".pagination a",function(e){e.preventDefault();var t=$(this).closest(".user-administration"),i=t.find(".user-administration__user-search").val(),n=t.find(".user-administration__user-filter-option").val();window.EC5.users.getUsers($(this).attr("href").split("page=")[1],i,"server_role",n),window.scrollTo(0,0)});var i;e.on("keyup",".user-administration__user-search",function(e){var t=this.value;if(t.length>=3||13===e.keyCode){var n=$(this).closest(".user-administration"),r=n.find(".user-administration__user-filter__server_role").val(),a=n.find(".user-administration__user-filter__state").val(),s=200;clearTimeout(i),i=setTimeout(function(){window.EC5.users.getUsers(1,t,r,a)},s)}}),e.on("change",".user-administration__user-filter__state",function(e){var t=$(".user-administration__user-search").val(),i=$(".user-administration__user-filter__server-role").val();window.EC5.users.getUsers(1,t,i,this.value)}),e.on("change",".user-administration__user-filter__server-role",function(e){var t=$(".user-administration__user-search").val(),i=$(".user-administration__user-filter__state").val();window.EC5.users.getUsers(1,t,this.value,i)}),e.on("click",".user-administration__user-reset",function(e){e.preventDefault(),$(".user-administration__user-search").val(""),$(".user-administration__user-filter-option").val(""),window.EC5.users.getUsers()}),e.on("submit",".user-administration__table__state-form",function(e){e.preventDefault();var t=$(this).serialize(),i=$(this).attr("action");window.EC5.users.updateUser(i,t)}),e.on("submit",".user-administration__table__server-role-form",function(e){e.preventDefault();var t=$(this).serialize(),i=$(this).attr("action");window.EC5.users.updateUser(i,t)}),$(".manage-users__user-add-form").on("submit",function(e){e.preventDefault();var t=$(this).serialize(),i=$(this).attr("action");window.EC5.users.addUser(i,t,function(){$("#ec5ModalAddUser").modal("hide")})}),t.find(".show-password-control").on("click",function(){$(this).prop("checked")?t.find("input.password-input").each(function(){$(this).attr("type","text")}):t.find("input.password-input").each(function(){$(this).attr("type","password")})})});